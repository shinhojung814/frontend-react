{"ast":null,"code":"var _jsxFileName = \"/Users/shinhojung/git/raising-alien-creatures/client/src/pages/Header/AuthRequestModal/index.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState } from \"react\";\nimport \"./AuthRequestModal.css\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport api from \"../../../apis/index\";\nimport * as socket from \"../../../apis/socket\";\nimport * as actions from \"../../../Redux/actions/index.js\";\nimport aquarium from \"../../../shared\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function AuthRequestModal(props) {\n  _s();\n\n  const dispatch = useDispatch();\n  const [authImage, setAuthImage] = useState(null);\n  const [authMessage, setAuthMessage] = useState(\"\");\n  const [authRequestClicked, setAuthRequestClicked] = useState(false);\n  const showAuthRequest = useSelector(state => state.modalOnOff.showAuthRequest);\n  const {\n    aliens,\n    selectedAlien\n  } = useSelector(({\n    room\n  }) => ({\n    aliens: room.aliens,\n    selectedAlien: room.selectedAlien\n  }));\n  const alien = aliens.find(a => a.id === selectedAlien);\n\n  const handleSubmit = async e => {\n    e.preventDefault();\n    if (authRequestClicked) return;\n    /* 예외 처리 Handling 1. */\n\n    let day = {\n      1: \"mon\",\n      2: \"tue\",\n      3: \"wed\",\n      4: \"thu\",\n      5: \"fri\",\n      6: \"sat\",\n      0: \"sun\"\n    };\n    let date = new Date(new Date().toLocaleString(\"en-US\", {\n      timeZone: \"Asia/Seoul\"\n    }));\n    let today = day[date.getDay()];\n\n    if (alien[today] === 0) {\n      console.log(\"인증 가능 요일이 아닙니다.\");\n      return;\n    } else {}\n    /* 예외 처리 Handling 2. */\n\n\n    if (alien.practice_status > 0) {\n      /* 해당 날짜에 이미 요청된 Alien 인 경우 -> front에서 Error 문구 처리 부탁드립니다. */\n      console.log(\"이미 인증요청 완료된 건 입니다.\"); // alert(\"이미 인증 요청이 완료되었습니다.\")\n\n      return;\n    }\n\n    let res = await api.get(\"/main/s3Url\");\n    const {\n      url\n    } = res.data;\n    console.log(\"res\", res); // post the image direclty to the s3 bucket\n\n    if (authImage) {\n      await fetch(url, {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": \"multipart/form-data\"\n        },\n        body: authImage[0]\n      });\n    }\n\n    const imageUrl = url.split(\"?\")[0];\n    const resp = {\n      user_info_id: alien.user_info_id,\n      alien_id: alien.id,\n      challenge_id: alien.challenge_id,\n      comments: authMessage,\n      image_url: imageUrl\n    };\n    setAuthRequestClicked(true);\n    res = await api.post(\"/challenge/auth\", resp);\n    console.log(\"res\", res);\n\n    if (res.data.result === \"success\") {\n      setAuthImage(null);\n      setAuthRequestClicked(false);\n      dispatch(actions.requestAuth(alien.id)); // socket\n\n      let info = {\n        userId: alien.user_info_id,\n        challengeId: alien.challenge_id,\n        alienId: alien.id,\n        msg: `\"${alien.challenge_name}\" 챌린지에서 \"${alien.user_nickname}\"님이 승인을 요청했습니다.`\n      };\n      socket.emitAuthRequest(info); // canvas\n\n      aquarium.getCurrentRoom().getMonster(alien.id).overwrite({\n        practiceStatus: 1\n      }); // redux\n\n      dispatch(actions.requestAuth(alien.id));\n      dispatch(actions.showAuthRequest(false));\n    } else {\n      // TODO: 실패 처리\n      setAuthRequestClicked(false);\n    }\n  };\n\n  const handleCancel = () => {\n    dispatch(actions.showAuthRequest(false));\n    setAuthRequestClicked(false);\n    setAuthImage(null);\n  };\n\n  if (!showAuthRequest) {\n    return /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 12\n    }, this);\n  }\n\n  if (!alien) {\n    // TODO: handle error\n    return /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 12\n    }, this);\n  }\n\n  console.log(\"authRequestClicked\", authRequestClicked);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"Overlay\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"AuthRequestModal\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"flex flex-col  px-8 py-8 justify-center bg-indigo-50 rounded-xl shadow dark:bg-gray-800 overflow-y-auto z-10\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-center items-center self-end text-gray-400 hover:text-gray-500 \",\n          children: /*#__PURE__*/_jsxDEV(\"svg\", {\n            className: \"fixed w-5 h-5\",\n            fill: \"none\",\n            stroke: \"currentColor\",\n            viewBox: \"0 0 24 24\",\n            onClick: handleCancel,\n            children: /*#__PURE__*/_jsxDEV(\"path\", {\n              strokeLinecap: \"round\",\n              strokeLinejoin: \"round\",\n              strokeWidth: \"3\",\n              d: \"M6 18L18 6M6 6l12 12\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 139,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 132,\n            columnNumber: 13\n          }, this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 131,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \" px-1 py-4 text-lg \",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pb-8\",\n            children: /*#__PURE__*/_jsxDEV(\"h2\", {\n              className: \"text-3xl font-bold\",\n              children: alien.challenge_name\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 149,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 148,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"pb-4\",\n            children: /*#__PURE__*/_jsxDEV(\"label\", {\n              className: \"text-xl font-bold\",\n              children: \"\\uC778\\uC99D \\uC0AC\\uC9C4 \\uCCA8\\uBD80\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 152,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 151,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"Attachments1\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"flex flex-col fixed min-h-0  items-center\",\n              children: [/*#__PURE__*/_jsxDEV(\"i\", {\n                className: \"fa fa-folder-open fa-3x text-blue-700\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 156,\n                columnNumber: 17\n              }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                className: \"block text-gray-400 font-normal text-center  text-sm md:text-lg sm:text-xs\",\n                children: \"\\uD074\\uB9AD \\uB610\\uB294 \\uB4DC\\uB798\\uADF8\\uD558\\uC5EC \\uC778\\uC99D \\uC0AC\\uC9C4\\uC744 \\uC62C\\uB824\\uC8FC\\uC138\\uC694.\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 157,\n                columnNumber: 17\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 155,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"file\",\n              className: \"h-full opacity-0 justify-center\",\n              name: \"\",\n              accept: \"image/*\",\n              id: \"imageInput\",\n              onChange: e => {\n                setAuthImage(e.target.files);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 161,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 154,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"justify-center items-center\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"py-4\",\n              children: /*#__PURE__*/_jsxDEV(\"label\", {\n                className: \"text-xl font-bold\",\n                children: \"\\uAC04\\uB2E8 \\uCF54\\uBA58\\uD2B8\"\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 174,\n                columnNumber: 17\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 173,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"textarea\", {\n              type: \"text\",\n              className: \"Comment\",\n              placeholder: \"\\uC778\\uC99D \\uC0AC\\uC9C4\\uACFC \\uC2E4\\uCC9C \\uB0B4\\uC6A9\\uC744 \\uAC04\\uB2E8\\uD788 \\uC124\\uBA85\\uD574\\uC8FC\\uC138\\uC694.\",\n              onChange: e => {\n                setAuthMessage(e.target.value);\n              }\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 176,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 172,\n            columnNumber: 13\n          }, this), authImage && authImage[0] ? /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \" py-6\",\n            children: /*#__PURE__*/_jsxDEV(\"img\", {\n              style: {\n                maxHeight: \"200px\",\n                maxWidth: \"100%\",\n                margin: \"auto\"\n              },\n              src: URL.createObjectURL(authImage[0]),\n              alt: \"auth\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 187,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 186,\n            columnNumber: 15\n          }, this) : /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 198,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"mt-6\",\n            children: [/*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              className: \"ml-2 h-8 w-20 bg-gray-400 rounded text-white hover:bg-blue-700\",\n              onClick: () => {\n                setAuthImage(null);\n              },\n              children: \"\\uCCA8\\uBD80 \\uCDE8\\uC18C\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 201,\n              columnNumber: 15\n            }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"button\",\n              className: \"ml-2 h-8 w-20 bg-blue-600 rounded text-white hover:bg-blue-700\",\n              onClick: handleSubmit,\n              children: \"\\uC778\\uC99D\\uD558\\uAE30\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 210,\n              columnNumber: 15\n            }, this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 200,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 147,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 130,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 127,\n    columnNumber: 5\n  }, this);\n}\n\n_s(AuthRequestModal, \"1/PRecjdz5s9WDt+S/BqfgIz8lI=\", false, function () {\n  return [useDispatch, useSelector, useSelector];\n});\n\n_c = AuthRequestModal;\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthRequestModal\");","map":{"version":3,"sources":["/Users/shinhojung/git/raising-alien-creatures/client/src/pages/Header/AuthRequestModal/index.js"],"names":["React","useState","useSelector","useDispatch","api","socket","actions","aquarium","AuthRequestModal","props","dispatch","authImage","setAuthImage","authMessage","setAuthMessage","authRequestClicked","setAuthRequestClicked","showAuthRequest","state","modalOnOff","aliens","selectedAlien","room","alien","find","a","id","handleSubmit","e","preventDefault","day","date","Date","toLocaleString","timeZone","today","getDay","console","log","practice_status","res","get","url","data","fetch","method","headers","body","imageUrl","split","resp","user_info_id","alien_id","challenge_id","comments","image_url","post","result","requestAuth","info","userId","challengeId","alienId","msg","challenge_name","user_nickname","emitAuthRequest","getCurrentRoom","getMonster","overwrite","practiceStatus","handleCancel","target","files","value","maxHeight","maxWidth","margin","URL","createObjectURL"],"mappings":"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","sourcesContent":["import React, { useState } from \"react\";\nimport \"./AuthRequestModal.css\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport api from \"../../../apis/index\";\nimport * as socket from \"../../../apis/socket\";\nimport * as actions from \"../../../Redux/actions/index.js\";\nimport aquarium from \"../../../shared\";\n\nexport default function AuthRequestModal(props) {\n  const dispatch = useDispatch();\n  const [authImage, setAuthImage] = useState(null);\n  const [authMessage, setAuthMessage] = useState(\"\");\n  const [authRequestClicked, setAuthRequestClicked] = useState(false);\n\n  const showAuthRequest = useSelector(\n    (state) => state.modalOnOff.showAuthRequest\n  );\n  const { aliens, selectedAlien } = useSelector(({ room }) => ({\n    aliens: room.aliens,\n    selectedAlien: room.selectedAlien,\n  }));\n  const alien = aliens.find((a) => a.id === selectedAlien);\n\n  const handleSubmit = async (e) => {\n    e.preventDefault();\n    if (authRequestClicked) return;\n\n    /* 예외 처리 Handling 1. */\n    let day = {\n      1: \"mon\",\n      2: \"tue\",\n      3: \"wed\",\n      4: \"thu\",\n      5: \"fri\",\n      6: \"sat\",\n      0: \"sun\",\n    };\n\n    let date = new Date(\n      new Date().toLocaleString(\"en-US\", { timeZone: \"Asia/Seoul\" })\n    );\n    let today = day[date.getDay()];\n    if (alien[today] === 0) {\n      console.log(\"인증 가능 요일이 아닙니다.\");\n      return;\n    } else {\n    }\n\n    /* 예외 처리 Handling 2. */\n    if (alien.practice_status > 0) {\n      /* 해당 날짜에 이미 요청된 Alien 인 경우 -> front에서 Error 문구 처리 부탁드립니다. */\n      console.log(\"이미 인증요청 완료된 건 입니다.\");\n      // alert(\"이미 인증 요청이 완료되었습니다.\")\n      return;\n    }\n\n    let res = await api.get(\"/main/s3Url\");\n    const { url } = res.data;\n    console.log(\"res\", res);\n    // post the image direclty to the s3 bucket\n    if (authImage) {\n      await fetch(url, {\n        method: \"PUT\",\n        headers: {\n          \"Content-Type\": \"multipart/form-data\",\n        },\n        body: authImage[0],\n      });\n    }\n    const imageUrl = url.split(\"?\")[0];\n    const resp = {\n      user_info_id: alien.user_info_id,\n      alien_id: alien.id,\n      challenge_id: alien.challenge_id,\n      comments: authMessage,\n      image_url: imageUrl,\n    };\n\n    setAuthRequestClicked(true);\n    res = await api.post(\"/challenge/auth\", resp);\n    console.log(\"res\", res);\n\n    if (res.data.result === \"success\") {\n      setAuthImage(null);\n      setAuthRequestClicked(false);\n      dispatch(actions.requestAuth(alien.id));\n      // socket\n      let info = {\n        userId: alien.user_info_id,\n        challengeId: alien.challenge_id,\n        alienId: alien.id,\n        msg: `\"${alien.challenge_name}\" 챌린지에서 \"${alien.user_nickname}\"님이 승인을 요청했습니다.`,\n      };\n      socket.emitAuthRequest(info);\n      // canvas\n      aquarium\n        .getCurrentRoom()\n        .getMonster(alien.id)\n        .overwrite({ practiceStatus: 1 });\n      // redux\n      dispatch(actions.requestAuth(alien.id));\n      dispatch(actions.showAuthRequest(false));\n    } else {\n      // TODO: 실패 처리\n      setAuthRequestClicked(false);\n    }\n  };\n\n  const handleCancel = () => {\n    dispatch(actions.showAuthRequest(false));\n    setAuthRequestClicked(false);\n    setAuthImage(null);\n  };\n\n  if (!showAuthRequest) {\n    return <div />;\n  }\n\n  if (!alien) {\n    // TODO: handle error\n    return <div />;\n  }\n\n  console.log(\"authRequestClicked\", authRequestClicked);\n\n  return (\n    <div>\n      <div className={\"Overlay\"} />\n      <div className={\"AuthRequestModal\"}>\n        <div className=\"flex flex-col  px-8 py-8 justify-center bg-indigo-50 rounded-xl shadow dark:bg-gray-800 overflow-y-auto z-10\">\n          <div className=\"flex justify-center items-center self-end text-gray-400 hover:text-gray-500 \">\n            <svg\n              className=\"fixed w-5 h-5\"\n              fill=\"none\"\n              stroke=\"currentColor\"\n              viewBox=\"0 0 24 24\"\n              onClick={handleCancel}\n            >\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth=\"3\"\n                d=\"M6 18L18 6M6 6l12 12\"\n              ></path>\n            </svg>\n          </div>\n          <div className=\" px-1 py-4 text-lg \">\n            <div className=\"pb-8\">\n              <h2 className=\"text-3xl font-bold\">{alien.challenge_name}</h2>\n            </div>\n            <div className=\"pb-4\">\n              <label className=\"text-xl font-bold\">인증 사진 첨부</label>\n            </div>\n            <div className=\"Attachments1\">\n              <div className=\"flex flex-col fixed min-h-0  items-center\">\n                <i className=\"fa fa-folder-open fa-3x text-blue-700\" />\n                <span className=\"block text-gray-400 font-normal text-center  text-sm md:text-lg sm:text-xs\">\n                  클릭 또는 드래그하여 인증 사진을 올려주세요.\n                </span>\n              </div>\n              <input\n                type=\"file\"\n                className=\"h-full opacity-0 justify-center\"\n                name=\"\"\n                accept=\"image/*\"\n                id=\"imageInput\"\n                onChange={(e) => {\n                  setAuthImage(e.target.files);\n                }}\n              />\n            </div>\n            <div className=\"justify-center items-center\">\n              <div className=\"py-4\">\n                <label className=\"text-xl font-bold\">간단 코멘트</label>\n              </div>\n              <textarea\n                type=\"text\"\n                className=\"Comment\"\n                placeholder=\"인증 사진과 실천 내용을 간단히 설명해주세요.\"\n                onChange={(e) => {\n                  setAuthMessage(e.target.value);\n                }}\n              ></textarea>\n            </div>\n            {authImage && authImage[0] ? (\n              <div className=\" py-6\">\n                <img\n                  style={{\n                    maxHeight: \"200px\",\n                    maxWidth: \"100%\",\n                    margin: \"auto\",\n                  }}\n                  src={URL.createObjectURL(authImage[0])}\n                  alt=\"auth\"\n                />\n              </div>\n            ) : (\n              <div></div>\n            )}\n            <div className=\"mt-6\">\n              <button\n                type=\"button\"\n                className=\"ml-2 h-8 w-20 bg-gray-400 rounded text-white hover:bg-blue-700\"\n                onClick={() => {\n                  setAuthImage(null);\n                }}\n              >\n                첨부 취소\n              </button>\n              <button\n                type=\"button\"\n                className=\"ml-2 h-8 w-20 bg-blue-600 rounded text-white hover:bg-blue-700\"\n                onClick={handleSubmit}\n              >\n                인증하기\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n"]},"metadata":{},"sourceType":"module"}