{"ast":null,"code":"import Camera from \"./Camera\";\nimport Wanderer from \"../creature/Wanderer\";\nimport { FRAME_PER_SEC } from \"../lib/Constants\";\n\nclass RoomClient {\n  constructor(roomId) {\n    this.initMonsters = monsters => {\n      console.log(\"initMonsters\", monsters);\n      this.fieldState.monsters = {};\n      monsters.forEach(mon => {\n        const monster = new Wanderer({\n          userId: mon.user_info_id,\n          monId: mon.id,\n          color: mon.color,\n          authCnt: mon.accured_auth_cnt,\n          image_url: mon.image_url\n        });\n        monster.isUserOnRoom = this.usersOnRoom.includes(monster.userId); // console.log(monster.monId, monster.isUserOnRoom);\n\n        this.fieldState.monsters[mon.id] = monster;\n      });\n    };\n\n    this.syncFieldState = socketState => {\n      const monsterLength = Object.keys(socketState.monsters).length;\n      console.log(\"[socket] syncFieldState:\", socketState);\n\n      if (monsterLength <= 0) {\n        console.error(\"ERROR!! zero monster issue should be fixed!!\");\n        return;\n      } // monster를 하나씩 업데이트\n\n\n      for (let monId in socketState.monsters) {\n        // socket에서 받아온 monster plain object\n        const monPlain = socketState.monsters[monId]; // 해당 monster가 없는 경우 object 생성해 추가\n\n        if (!(monId in this.fieldState.monsters)) {\n          const monster = new Wanderer({\n            userId: monPlain.userId,\n            monId: monPlain.monId\n          });\n          monster.overwrite(monPlain);\n          this.fieldState.monsters[monId] = monster;\n        } // 기존에 있던 경우 일부만 변경\n        else {\n            this.fieldState.monsters[monId].sync(monPlain);\n          }\n      } // this.fieldState = socketState;\n\n    };\n\n    this.usersOnRoomHandler = users => {\n      console.log(\"usersOnRoomHandler\", users);\n      this.usersOnRoom = users;\n\n      for (let monId in this.fieldState.monsters) {\n        let mon = this.fieldState.monsters[monId];\n        mon.isUserOnRoom = this.usersOnRoom.includes(mon.userId); // console.log(mon.monId, mon.isUserOnRoom);\n      }\n    };\n\n    this.eraseUsersOnRoom = () => {\n      for (let monId in this.fieldState.monsters) {\n        let mon = this.fieldState.monsters[monId];\n        mon.isUserOnRoom = false;\n      }\n    };\n\n    // console.log(\"Room init\", roomId);\n    this.roomId = roomId;\n    this.camera = new Camera();\n    this.initFieldState();\n    this.interval = undefined;\n    this.usersOnRoom = [];\n  }\n\n  initFieldState() {\n    // TODO: 서버에서 해당 어항에 포함된 몬스터들을 가져오기\n    const state = {\n      monsters: {}\n    };\n    this.fieldState = state;\n  }\n\n  updateGameState() {\n    for (let monId in this.fieldState.monsters) {\n      let mon = this.fieldState.monsters[monId];\n      mon.run();\n    }\n  }\n\n  start() {\n    console.log(\"[room] start\", this.roomId);\n    clearInterval(this.interval);\n    this.interval = setInterval(() => this.updateGameState(), 1000 / FRAME_PER_SEC);\n  }\n\n  close() {\n    console.log(\"[room] close\", this.roomId);\n    clearInterval(this.interval);\n  }\n\n}\n\nexport default RoomClient;","map":{"version":3,"sources":["/Users/shinhojung/git/raising-alien-creatures/client/src/shared/room/RoomClient.js"],"names":["Camera","Wanderer","FRAME_PER_SEC","RoomClient","constructor","roomId","initMonsters","monsters","console","log","fieldState","forEach","mon","monster","userId","user_info_id","monId","id","color","authCnt","accured_auth_cnt","image_url","isUserOnRoom","usersOnRoom","includes","syncFieldState","socketState","monsterLength","Object","keys","length","error","monPlain","overwrite","sync","usersOnRoomHandler","users","eraseUsersOnRoom","camera","initFieldState","interval","undefined","state","updateGameState","run","start","clearInterval","setInterval","close"],"mappings":"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","sourcesContent":["import Camera from \"./Camera\";\nimport Wanderer from \"../creature/Wanderer\";\nimport { FRAME_PER_SEC } from \"../lib/Constants\";\n\nclass RoomClient {\n  constructor(roomId) {\n    // console.log(\"Room init\", roomId);\n    this.roomId = roomId;\n    this.camera = new Camera();\n    this.initFieldState();\n    this.interval = undefined;\n    this.usersOnRoom = [];\n  }\n\n  initFieldState() {\n    // TODO: 서버에서 해당 어항에 포함된 몬스터들을 가져오기\n    const state = {\n      monsters: {},\n    };\n    this.fieldState = state;\n  }\n\n  initMonsters = (monsters) => {\n    console.log(\"initMonsters\", monsters);\n    this.fieldState.monsters = {};\n    monsters.forEach((mon) => {\n      const monster = new Wanderer({\n        userId: mon.user_info_id,\n        monId: mon.id,\n        color: mon.color,\n        authCnt: mon.accured_auth_cnt,\n        image_url: mon.image_url,\n      });\n      monster.isUserOnRoom = this.usersOnRoom.includes(monster.userId);\n      // console.log(monster.monId, monster.isUserOnRoom);\n      this.fieldState.monsters[mon.id] = monster;\n    });\n  };\n\n  syncFieldState = (socketState) => {\n    const monsterLength = Object.keys(socketState.monsters).length;\n    console.log(\"[socket] syncFieldState:\", socketState);\n    if (monsterLength <= 0) {\n      console.error(\"ERROR!! zero monster issue should be fixed!!\");\n      return;\n    }\n    // monster를 하나씩 업데이트\n    for (let monId in socketState.monsters) {\n      // socket에서 받아온 monster plain object\n      const monPlain = socketState.monsters[monId];\n      // 해당 monster가 없는 경우 object 생성해 추가\n      if (!(monId in this.fieldState.monsters)) {\n        const monster = new Wanderer({\n          userId: monPlain.userId,\n          monId: monPlain.monId,\n        });\n        monster.overwrite(monPlain);\n        this.fieldState.monsters[monId] = monster;\n      }\n      // 기존에 있던 경우 일부만 변경\n      else {\n        this.fieldState.monsters[monId].sync(monPlain);\n      }\n    }\n    // this.fieldState = socketState;\n  };\n\n  updateGameState() {\n    for (let monId in this.fieldState.monsters) {\n      let mon = this.fieldState.monsters[monId];\n      mon.run();\n    }\n  }\n\n  usersOnRoomHandler = (users) => {\n    console.log(\"usersOnRoomHandler\", users);\n    this.usersOnRoom = users;\n    for (let monId in this.fieldState.monsters) {\n      let mon = this.fieldState.monsters[monId];\n      mon.isUserOnRoom = this.usersOnRoom.includes(mon.userId);\n      // console.log(mon.monId, mon.isUserOnRoom);\n    }\n  };\n\n  eraseUsersOnRoom = () => {\n    for (let monId in this.fieldState.monsters) {\n      let mon = this.fieldState.monsters[monId];\n      mon.isUserOnRoom = false;\n    }\n  };\n\n  start() {\n    console.log(\"[room] start\", this.roomId);\n    clearInterval(this.interval);\n    this.interval = setInterval(\n      () => this.updateGameState(),\n      1000 / FRAME_PER_SEC\n    );\n  }\n\n  close() {\n    console.log(\"[room] close\", this.roomId);\n    clearInterval(this.interval);\n  }\n}\n\nexport default RoomClient;\n"]},"metadata":{},"sourceType":"module"}