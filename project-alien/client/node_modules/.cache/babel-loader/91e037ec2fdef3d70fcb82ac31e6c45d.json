{"ast":null,"code":"var _jsxFileName = \"/Users/shinhojung/git/raising-alien-creatures/client/src/pages/MultiAquarium/Room/ChallengeRoom.js\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect } from \"react\";\nimport Room from \"../../../shared/room/RoomClient\";\nimport { useParams } from \"react-router-dom\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport * as actions from \"../../../Redux/actions\";\nimport api from \"../../../apis\";\nimport * as socket from \"../../../apis/socket\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function ChallengeRoom(props) {\n  _s();\n\n  const dispatch = useDispatch(); // 챌린지 정보 가져오기\n\n  let params = useParams();\n  const challengeId = params.challengeId;\n  const roomId = `challenge-${challengeId}`;\n  const {\n    rooms\n  } = props;\n  console.log(\"ChallengeRoom 정보\", params);\n  if (!rooms.current) rooms.current = {};\n  if (!rooms.current[roomId]) rooms.current[roomId] = new Room(roomId); // user 정보 확인\n\n  const {\n    user\n  } = useSelector(({\n    user\n  }) => ({\n    user: user.user\n  }));\n  const userId = user && user.id;\n\n  const isChaIdIn = (challenges, cId) => {\n    return challenges.findIndex(c => c.Challenge_id === cId) !== -1;\n  };\n\n  let participating = user && isChaIdIn(user.challenges, Number(challengeId)); // console.log(\"[ChallengeRoom] is participating?\", participating);\n\n  useEffect(() => {\n    try {\n      const fetchData = async () => {\n        const res = await api.get(`/challenge/${challengeId}`);\n        console.log(\"fetch challenge data\", res.data);\n\n        if (res.data.result === \"success\") {\n          // rooms 상태 정보\n          const aliens = res.data.aliens;\n          const challenge = res.data.challenge;\n          const roomTitle = `${challenge.challenge_name}`;\n          rooms.current[roomId].initMonsters(aliens);\n          rooms.current[roomId].start(); // update redux room info\n\n          dispatch(actions.setRoom({\n            roomId,\n            aliens,\n            roomTitle,\n            challenge\n          }));\n        } else {}\n      };\n\n      fetchData();\n    } catch (err) {\n      console.error(\"fetchData fail\", err);\n    }\n\n    return () => {\n      rooms.current[roomId].close();\n    };\n  }, [rooms, roomId, challengeId, dispatch]);\n  useEffect(() => {\n    // user가 참여중인 방인지 확인\n    if (participating && rooms.current[roomId]) {\n      // console.log(\"handle socket here!\", participating);\n      socket.initAndJoin({\n        roomId,\n        userId: userId\n      });\n      socket.usersOnRoom(rooms.current[roomId].usersOnRoomHandler);\n      socket.messageReceive(msg => dispatch(actions.setMessage(msg))); // socket.subscribe(rooms.current[roomId].syncFieldState);\n    } else if (rooms.current[roomId]) {\n      rooms.current[roomId].eraseUsersOnRoom();\n    }\n\n    return () => {\n      socket.disconnect(roomId);\n    };\n  }, [userId, rooms, roomId, challengeId, participating, dispatch]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {}, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 72,\n    columnNumber: 10\n  }, this);\n}\n\n_s(ChallengeRoom, \"hxzrhRciT1hgrtwiJpxaNrHR3bE=\", false, function () {\n  return [useDispatch, useParams, useSelector];\n});\n\n_c = ChallengeRoom;\n\nvar _c;\n\n$RefreshReg$(_c, \"ChallengeRoom\");","map":{"version":3,"sources":["/Users/shinhojung/git/raising-alien-creatures/client/src/pages/MultiAquarium/Room/ChallengeRoom.js"],"names":["React","useEffect","Room","useParams","useSelector","useDispatch","actions","api","socket","ChallengeRoom","props","dispatch","params","challengeId","roomId","rooms","console","log","current","user","userId","id","isChaIdIn","challenges","cId","findIndex","c","Challenge_id","participating","Number","fetchData","res","get","data","result","aliens","challenge","roomTitle","challenge_name","initMonsters","start","setRoom","err","error","close","initAndJoin","usersOnRoom","usersOnRoomHandler","messageReceive","msg","setMessage","eraseUsersOnRoom","disconnect"],"mappings":"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","sourcesContent":["import React, { useEffect } from \"react\";\nimport Room from \"../../../shared/room/RoomClient\";\nimport { useParams } from \"react-router-dom\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport * as actions from \"../../../Redux/actions\";\n\nimport api from \"../../../apis\";\nimport * as socket from \"../../../apis/socket\";\n\nexport default function ChallengeRoom(props) {\n  const dispatch = useDispatch();\n  // 챌린지 정보 가져오기\n  let params = useParams();\n  const challengeId = params.challengeId;\n  const roomId = `challenge-${challengeId}`;\n  const { rooms } = props;\n  console.log(\"ChallengeRoom 정보\", params);\n  if (!rooms.current) rooms.current = {};\n  if (!rooms.current[roomId]) rooms.current[roomId] = new Room(roomId);\n\n  // user 정보 확인\n  const { user } = useSelector(({ user }) => ({ user: user.user }));\n  const userId = user && user.id;\n  const isChaIdIn = (challenges, cId) => {\n    return challenges.findIndex((c) => c.Challenge_id === cId) !== -1;\n  };\n  let participating = user && isChaIdIn(user.challenges, Number(challengeId));\n  // console.log(\"[ChallengeRoom] is participating?\", participating);\n\n  useEffect(() => {\n    try {\n      const fetchData = async () => {\n        const res = await api.get(`/challenge/${challengeId}`);\n        console.log(\"fetch challenge data\", res.data);\n        if (res.data.result === \"success\") {\n          // rooms 상태 정보\n          const aliens = res.data.aliens;\n          const challenge = res.data.challenge;\n          const roomTitle = `${challenge.challenge_name}`;\n          rooms.current[roomId].initMonsters(aliens);\n          rooms.current[roomId].start();\n          // update redux room info\n          dispatch(actions.setRoom({ roomId, aliens, roomTitle, challenge }));\n        } else {\n        }\n      };\n      fetchData();\n    } catch (err) {\n      console.error(\"fetchData fail\", err);\n    }\n    return () => {\n      rooms.current[roomId].close();\n    };\n  }, [rooms, roomId, challengeId, dispatch]);\n\n  useEffect(() => {\n    // user가 참여중인 방인지 확인\n    if (participating && rooms.current[roomId]) {\n      // console.log(\"handle socket here!\", participating);\n      socket.initAndJoin({ roomId, userId: userId });\n      socket.usersOnRoom(rooms.current[roomId].usersOnRoomHandler);\n      socket.messageReceive((msg) => dispatch(actions.setMessage(msg)));\n      // socket.subscribe(rooms.current[roomId].syncFieldState);\n    } else if (rooms.current[roomId]) {\n      rooms.current[roomId].eraseUsersOnRoom();\n    }\n    return () => {\n      socket.disconnect(roomId);\n    };\n  }, [userId, rooms, roomId, challengeId, participating, dispatch]);\n\n  return <div></div>;\n}\n"]},"metadata":{},"sourceType":"module"}