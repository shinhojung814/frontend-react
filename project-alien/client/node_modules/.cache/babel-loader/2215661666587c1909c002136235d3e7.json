{"ast":null,"code":"import Vector2D from \"../lib/Vector2D.js\";\nimport { S3URL } from \"../lib/Constants.js\";\n\nclass Monster {\n  constructor(props) {\n    this.userId = props.userId;\n    this.monId = props.monId;\n    this.isUserOnRoom = false;\n    this.authCnt = props.authCnt || 0;\n    this.wanderRange = props.wanderRange;\n    this.color = props.color;\n    this.size = 40 + this.authCnt * 2;\n    this.showBubble = false;\n    this.practiceStatus = 0;\n    this.practiceDays = []; // Alien_base/fish_0.png-Alien_base/fish_0_reverse.png-4-3-1992-981\n    //          0                      1                   2 3  4    5\n    // TODO: 임시처리된 코드 개선\n\n    let parsed = props.image_url && props.image_url.split(\"-\");\n\n    if (parsed && parsed[0].startsWith(\"Alien_base\")) {\n      this.image_url = parsed;\n    }\n\n    this.init();\n  }\n\n  init() {\n    // generate random monster\n    this.location = this.getRandLocation();\n    this.velocity = {\n      x: 0,\n      y: 0\n    };\n    this.acceleration = {\n      x: 0,\n      y: 0\n    };\n    this.maxSpeed = 2;\n    this.maxForce = 0.2;\n    this.seekLimit = 50;\n    this.defaultAngle = -Math.PI / 2;\n    this.angle = this.defaultAngle;\n    this.destination = { ...this.location\n    }; // this.color = this.getRandomColor();\n    // for sprite images\n\n    if (this.image_url) {\n      this.spriteWidth = this.image_url[4] / this.image_url[2];\n      this.spriteHeight = this.image_url[5] / this.image_url[3];\n      this.spriteAngle = 0;\n      this.frameX = Math.floor(Math.random() * this.image_url[2]); // 0~3\n\n      this.frameY = Math.floor(Math.random() * this.image_url[3]); // 0~2\n\n      this.fishLeft = new Image();\n      this.fishLeft.src = S3URL + this.image_url[0];\n      this.fishRight = new Image();\n      this.fishRight.src = S3URL + this.image_url[1];\n      this.bubbleR = new Image();\n      this.bubbleR.src = require(\"../../image/bubble-512px-red.png\").default;\n      this.bubbleW = new Image();\n      this.bubbleW.src = require(\"../../image/bubble-512px.png\").default;\n    }\n  }\n\n  overwrite(monPlain) {\n    for (const property in monPlain) {\n      this[property] = monPlain[property];\n    }\n  }\n\n  sync(monPlain) {\n    // temp\n    this.destination = monPlain.destination;\n    this.size = monPlain.size;\n  }\n\n  getRandLocation() {\n    let randRange = 300;\n    let x = (Math.random() - 0.5) * randRange;\n    let y = (Math.random() - 0.5) * randRange;\n    return {\n      x,\n      y\n    };\n  }\n\n  calculateFrames(frameCnt) {\n    if (frameCnt % 10 === 0) {\n      this.frameX++;\n      this.frameY += this.frameX === parseInt(this.image_url[2]) ? 1 : 0;\n      this.frameX %= this.image_url[2];\n      this.frameY %= this.image_url[3];\n    }\n  }\n\n  display(ctx, frameCnt, room) {\n    let x = room.camera.getCanvasSize(this.location.x);\n    let y = room.camera.getCanvasSize(this.location.y);\n    let size = room.camera.getCanvasSize(this.size); // // draw circle\n    // ctx.beginPath();\n    // ctx.arc(x, y, size / 2, 0, Math.PI * 2);\n    // ctx.fillStyle = this.color;\n    // if (this.isUserOnRoom && frameCnt % 100 <= 40) {\n    //   ctx.fillStyle = \"tomato\";\n    // }\n    // ctx.fill();\n    // draw sprite images\n\n    if (this.image_url) {\n      this.calculateFrames(frameCnt);\n      ctx.save();\n      ctx.translate(x, y);\n      let direction = this.location.x - this.destination.x;\n      ctx.rotate(this.spriteAngle);\n\n      if (direction > 0) {\n        ctx.drawImage(this.fishLeft, this.frameX * this.spriteWidth, this.frameY * this.spriteHeight, this.spriteWidth, this.spriteHeight, -size / 2, -size / 2, size, size);\n      } else {\n        ctx.drawImage(this.fishRight, this.frameX * this.spriteWidth, this.frameY * this.spriteHeight, this.spriteWidth, this.spriteHeight, -size / 2, -size / 2, size, size);\n      }\n\n      if (this.showBubble) {\n        const todayValue = new Date().getDay();\n        const isPracticeDay = this.practiceDays[todayValue];\n\n        if (this.practiceStatus === 1) {\n          ctx.drawImage(this.bubbleW, -size / 2, -size / 2, size, size);\n        } else if (isPracticeDay && this.practiceStatus === 0) {\n          // TODO: 오늘이 인증이 필요한 날인지 확인\n          ctx.drawImage(this.bubbleR, -size / 2, -size / 2, size, size);\n        }\n      }\n\n      ctx.restore();\n    }\n  }\n\n  run() {\n    let force = this.seek(this.destination);\n    this.applyForce(force);\n    this.update();\n  }\n\n  seek(target) {\n    let desired = {\n      x: target.x,\n      y: target.y\n    };\n    Vector2D.sub(desired, this.location);\n    let dx = this.location.x - target.x;\n    let dy = this.location.y - target.y;\n    this.spriteAngle = Math.atan2(dy, dx);\n    let angleBase = this.spriteAngle - Math.PI; // let angleBase = Math.atan2(dy, dx) - Math.PI;\n\n    let dist = Vector2D.getMag(desired);\n    Vector2D.normalize(desired);\n\n    if (dist < this.seekLimit) {\n      let speed = dist / this.seekLimit * this.maxSpeed;\n      let da = this.defaultAngle;\n      Vector2D.mult(desired, speed);\n      this.angle = da - (da - angleBase) * (dist / this.seekLimit);\n    } else {\n      Vector2D.mult(desired, this.maxSpeed);\n      this.angle = angleBase;\n    }\n\n    Vector2D.sub(desired, this.velocity);\n    Vector2D.limit(desired, this.maxForce);\n    return desired;\n  }\n\n  applyForce(force) {\n    Vector2D.add(this.acceleration, force);\n  }\n\n  update() {\n    Vector2D.add(this.velocity, this.acceleration);\n    Vector2D.limit(this.velocity, this.maxSpeed);\n    Vector2D.mult(this.velocity, 0.99);\n    Vector2D.add(this.location, this.velocity);\n    Vector2D.mult(this.acceleration, 0);\n  }\n\n  directUpdate(features) {\n    // TODO: refactoring logic\n    for (const key in features) {\n      this[key] = features[key];\n    }\n  }\n\n  getRandomColor() {\n    const letters = \"0123456789ABCDEF\";\n    let color = \"#\";\n\n    for (let i = 0; i < 6; i++) {\n      color += letters[Math.floor(Math.random() * 16)];\n    }\n\n    return color;\n  }\n\n}\n\nexport default Monster;","map":{"version":3,"sources":["/Users/shinhojung/git/raising-alien-creatures/client/src/shared/creature/Monster.js"],"names":["Vector2D","S3URL","Monster","constructor","props","userId","monId","isUserOnRoom","authCnt","wanderRange","color","size","showBubble","practiceStatus","practiceDays","parsed","image_url","split","startsWith","init","location","getRandLocation","velocity","x","y","acceleration","maxSpeed","maxForce","seekLimit","defaultAngle","Math","PI","angle","destination","spriteWidth","spriteHeight","spriteAngle","frameX","floor","random","frameY","fishLeft","Image","src","fishRight","bubbleR","require","default","bubbleW","overwrite","monPlain","property","sync","randRange","calculateFrames","frameCnt","parseInt","display","ctx","room","camera","getCanvasSize","save","translate","direction","rotate","drawImage","todayValue","Date","getDay","isPracticeDay","restore","run","force","seek","applyForce","update","target","desired","sub","dx","dy","atan2","angleBase","dist","getMag","normalize","speed","da","mult","limit","add","directUpdate","features","key","getRandomColor","letters","i"],"mappings":"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","sourcesContent":["import Vector2D from \"../lib/Vector2D.js\";\nimport { S3URL } from \"../lib/Constants.js\";\n\nclass Monster {\n  constructor(props) {\n    this.userId = props.userId;\n    this.monId = props.monId;\n    this.isUserOnRoom = false;\n    this.authCnt = props.authCnt || 0;\n    this.wanderRange = props.wanderRange;\n    this.color = props.color;\n    this.size = 40 + this.authCnt * 2;\n\n    this.showBubble = false;\n    this.practiceStatus = 0;\n    this.practiceDays = [];\n\n    // Alien_base/fish_0.png-Alien_base/fish_0_reverse.png-4-3-1992-981\n    //          0                      1                   2 3  4    5\n    // TODO: 임시처리된 코드 개선\n    let parsed = props.image_url && props.image_url.split(\"-\");\n    if (parsed && parsed[0].startsWith(\"Alien_base\")) {\n      this.image_url = parsed;\n    }\n    this.init();\n  }\n\n  init() {\n    // generate random monster\n    this.location = this.getRandLocation();\n    this.velocity = { x: 0, y: 0 };\n    this.acceleration = { x: 0, y: 0 };\n\n    this.maxSpeed = 2;\n    this.maxForce = 0.2;\n    this.seekLimit = 50;\n\n    this.defaultAngle = -Math.PI / 2;\n    this.angle = this.defaultAngle;\n\n    this.destination = { ...this.location };\n    // this.color = this.getRandomColor();\n\n    // for sprite images\n    if (this.image_url) {\n      this.spriteWidth = this.image_url[4] / this.image_url[2];\n      this.spriteHeight = this.image_url[5] / this.image_url[3];\n      this.spriteAngle = 0;\n      this.frameX = Math.floor(Math.random() * this.image_url[2]); // 0~3\n      this.frameY = Math.floor(Math.random() * this.image_url[3]); // 0~2\n      this.fishLeft = new Image();\n      this.fishLeft.src = S3URL + this.image_url[0];\n      this.fishRight = new Image();\n      this.fishRight.src = S3URL + this.image_url[1];\n\n      this.bubbleR = new Image();\n      this.bubbleR.src = require(\"../../image/bubble-512px-red.png\").default;\n      this.bubbleW = new Image();\n      this.bubbleW.src = require(\"../../image/bubble-512px.png\").default;\n    }\n  }\n\n  overwrite(monPlain) {\n    for (const property in monPlain) {\n      this[property] = monPlain[property];\n    }\n  }\n\n  sync(monPlain) {\n    // temp\n    this.destination = monPlain.destination;\n    this.size = monPlain.size;\n  }\n\n  getRandLocation() {\n    let randRange = 300;\n    let x = (Math.random() - 0.5) * randRange;\n    let y = (Math.random() - 0.5) * randRange;\n    return { x, y };\n  }\n\n  calculateFrames(frameCnt) {\n    if (frameCnt % 10 === 0) {\n      this.frameX++;\n      this.frameY += this.frameX === parseInt(this.image_url[2]) ? 1 : 0;\n      this.frameX %= this.image_url[2];\n      this.frameY %= this.image_url[3];\n    }\n  }\n\n  display(ctx, frameCnt, room) {\n    let x = room.camera.getCanvasSize(this.location.x);\n    let y = room.camera.getCanvasSize(this.location.y);\n    let size = room.camera.getCanvasSize(this.size);\n\n    // // draw circle\n    // ctx.beginPath();\n    // ctx.arc(x, y, size / 2, 0, Math.PI * 2);\n    // ctx.fillStyle = this.color;\n    // if (this.isUserOnRoom && frameCnt % 100 <= 40) {\n    //   ctx.fillStyle = \"tomato\";\n    // }\n    // ctx.fill();\n\n    // draw sprite images\n    if (this.image_url) {\n      this.calculateFrames(frameCnt);\n      ctx.save();\n      ctx.translate(x, y);\n      let direction = this.location.x - this.destination.x;\n      ctx.rotate(this.spriteAngle);\n      if (direction > 0) {\n        ctx.drawImage(\n          this.fishLeft,\n          this.frameX * this.spriteWidth,\n          this.frameY * this.spriteHeight,\n          this.spriteWidth,\n          this.spriteHeight,\n          -size / 2,\n          -size / 2,\n          size,\n          size\n        );\n      } else {\n        ctx.drawImage(\n          this.fishRight,\n          this.frameX * this.spriteWidth,\n          this.frameY * this.spriteHeight,\n          this.spriteWidth,\n          this.spriteHeight,\n          -size / 2,\n          -size / 2,\n          size,\n          size\n        );\n      }\n\n      if (this.showBubble) {\n        const todayValue = new Date().getDay();\n        const isPracticeDay = this.practiceDays[todayValue];\n\n        if (this.practiceStatus === 1) {\n          ctx.drawImage(this.bubbleW, -size / 2, -size / 2, size, size);\n        } else if (isPracticeDay && this.practiceStatus === 0) {\n          // TODO: 오늘이 인증이 필요한 날인지 확인\n          ctx.drawImage(this.bubbleR, -size / 2, -size / 2, size, size);\n        }\n      }\n\n      ctx.restore();\n    }\n  }\n\n  run() {\n    let force = this.seek(this.destination);\n    this.applyForce(force);\n    this.update();\n  }\n\n  seek(target) {\n    let desired = { x: target.x, y: target.y };\n    Vector2D.sub(desired, this.location);\n\n    let dx = this.location.x - target.x;\n    let dy = this.location.y - target.y;\n    this.spriteAngle = Math.atan2(dy, dx);\n    let angleBase = this.spriteAngle - Math.PI;\n    // let angleBase = Math.atan2(dy, dx) - Math.PI;\n\n    let dist = Vector2D.getMag(desired);\n    Vector2D.normalize(desired);\n    if (dist < this.seekLimit) {\n      let speed = (dist / this.seekLimit) * this.maxSpeed;\n      let da = this.defaultAngle;\n      Vector2D.mult(desired, speed);\n      this.angle = da - (da - angleBase) * (dist / this.seekLimit);\n    } else {\n      Vector2D.mult(desired, this.maxSpeed);\n      this.angle = angleBase;\n    }\n\n    Vector2D.sub(desired, this.velocity);\n    Vector2D.limit(desired, this.maxForce);\n\n    return desired;\n  }\n\n  applyForce(force) {\n    Vector2D.add(this.acceleration, force);\n  }\n\n  update() {\n    Vector2D.add(this.velocity, this.acceleration);\n    Vector2D.limit(this.velocity, this.maxSpeed);\n    Vector2D.mult(this.velocity, 0.99);\n    Vector2D.add(this.location, this.velocity);\n    Vector2D.mult(this.acceleration, 0);\n  }\n\n  directUpdate(features) {\n    // TODO: refactoring logic\n    for (const key in features) {\n      this[key] = features[key];\n    }\n  }\n\n  getRandomColor() {\n    const letters = \"0123456789ABCDEF\";\n    let color = \"#\";\n    for (let i = 0; i < 6; i++) {\n      color += letters[Math.floor(Math.random() * 16)];\n    }\n    return color;\n  }\n}\n\nexport default Monster;\n"]},"metadata":{},"sourceType":"module"}