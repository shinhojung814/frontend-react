{"ast":null,"code":"import Camera from \"./Camera\";\nimport Wanderer from \"../creature/Wanderer\";\nimport { FRAME_PER_SEC } from \"../lib/Constants\";\n\nclass RoomClient {\n  constructor(roomId) {\n    this.initMonsters = monsters => {\n      this.fieldState.monsters = {};\n      monsters.forEach(mon => {\n        const monster = new Wanderer({\n          userId: mon.user_info_id,\n          monId: mon.id,\n          color: mon.color,\n          authCnt: mon.accuredAuthCnt\n        });\n        this.fieldState.monsters[mon.id] = monster;\n      });\n    };\n\n    this.syncFieldState = socketState => {\n      const monsterLength = Object.keys(socketState.monsters).length;\n      console.log(\"[socket] syncFieldState:\", socketState);\n\n      if (monsterLength <= 0) {\n        console.error(\"ERROR!! zero monster issue should be fixed!!\");\n        return;\n      } // monster를 하나씩 업데이트\n\n\n      for (let monId in socketState.monsters) {\n        // socket에서 받아온 monster plain object\n        const monPlain = socketState.monsters[monId]; // 해당 monster가 없는 경우 object 생성해 추가\n\n        if (!(monId in this.fieldState.monsters)) {\n          const monster = new Wanderer({\n            userId: monPlain.userId,\n            monId: monPlain.monId\n          });\n          monster.overwrite(monPlain);\n          this.fieldState.monsters[monId] = monster;\n        } // 기존에 있던 경우 일부만 변경\n        else {\n            this.fieldState.monsters[monId].sync(monPlain);\n          }\n      } // this.fieldState = socketState;\n\n    };\n\n    // console.log(\"Room init\", roomId);\n    this.roomId = roomId;\n    this.camera = new Camera();\n    this.initFieldState();\n    this.interval = undefined;\n  }\n\n  initFieldState() {\n    // TODO: 서버에서 해당 어항에 포함된 몬스터들을 가져오기\n    const state = {\n      monsters: {}\n    };\n    this.fieldState = state;\n  }\n\n  updateGameState() {\n    for (let monId in this.fieldState.monsters) {\n      let mon = this.fieldState.monsters[monId];\n      mon.run();\n    }\n  }\n\n  start() {\n    console.log(\"[room] start\", this.roomId);\n    this.interval = setInterval(() => this.updateGameState(), 1000 / FRAME_PER_SEC);\n  }\n\n  close() {\n    console.log(\"[room] close\", this.roomId);\n    clearInterval(this.interval);\n  }\n\n}\n\nexport default RoomClient;","map":{"version":3,"sources":["/Users/shinhojung/git/raising-alien-creatures/client/src/shared/room/RoomClient.js"],"names":["Camera","Wanderer","FRAME_PER_SEC","RoomClient","constructor","roomId","initMonsters","monsters","fieldState","forEach","mon","monster","userId","user_info_id","monId","id","color","authCnt","accuredAuthCnt","syncFieldState","socketState","monsterLength","Object","keys","length","console","log","error","monPlain","overwrite","sync","camera","initFieldState","interval","undefined","state","updateGameState","run","start","setInterval","close","clearInterval"],"mappings":"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","sourcesContent":["import Camera from \"./Camera\";\nimport Wanderer from \"../creature/Wanderer\";\nimport { FRAME_PER_SEC } from \"../lib/Constants\";\n\nclass RoomClient {\n  constructor(roomId) {\n    // console.log(\"Room init\", roomId);\n    this.roomId = roomId;\n    this.camera = new Camera();\n    this.initFieldState();\n    this.interval = undefined;\n  }\n\n  initFieldState() {\n    // TODO: 서버에서 해당 어항에 포함된 몬스터들을 가져오기\n    const state = {\n      monsters: {},\n    };\n    this.fieldState = state;\n  }\n\n  initMonsters = (monsters) => {\n    this.fieldState.monsters = {};\n    monsters.forEach((mon) => {\n      const monster = new Wanderer({\n        userId: mon.user_info_id,\n        monId: mon.id,\n        color: mon.color,\n        authCnt: mon.accuredAuthCnt,\n      });\n      this.fieldState.monsters[mon.id] = monster;\n    });\n  };\n\n  syncFieldState = (socketState) => {\n    const monsterLength = Object.keys(socketState.monsters).length;\n    console.log(\"[socket] syncFieldState:\", socketState);\n    if (monsterLength <= 0) {\n      console.error(\"ERROR!! zero monster issue should be fixed!!\");\n      return;\n    }\n    // monster를 하나씩 업데이트\n    for (let monId in socketState.monsters) {\n      // socket에서 받아온 monster plain object\n      const monPlain = socketState.monsters[monId];\n      // 해당 monster가 없는 경우 object 생성해 추가\n      if (!(monId in this.fieldState.monsters)) {\n        const monster = new Wanderer({\n          userId: monPlain.userId,\n          monId: monPlain.monId,\n        });\n        monster.overwrite(monPlain);\n        this.fieldState.monsters[monId] = monster;\n      }\n      // 기존에 있던 경우 일부만 변경\n      else {\n        this.fieldState.monsters[monId].sync(monPlain);\n      }\n    }\n    // this.fieldState = socketState;\n  };\n\n  updateGameState() {\n    for (let monId in this.fieldState.monsters) {\n      let mon = this.fieldState.monsters[monId];\n      mon.run();\n    }\n  }\n\n  start() {\n    console.log(\"[room] start\", this.roomId);\n    this.interval = setInterval(\n      () => this.updateGameState(),\n      1000 / FRAME_PER_SEC\n    );\n  }\n\n  close() {\n    console.log(\"[room] close\", this.roomId);\n    clearInterval(this.interval);\n  }\n}\n\nexport default RoomClient;\n"]},"metadata":{},"sourceType":"module"}