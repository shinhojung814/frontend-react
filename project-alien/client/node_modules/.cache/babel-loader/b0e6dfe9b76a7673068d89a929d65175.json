{"ast":null,"code":"var _jsxFileName = \"/Users/shinhojung/git/raising-alien-creatures/client/src/components/Canvas/index.js\";\nimport React, { Component } from \"react\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default class Canvas extends Component {\n  constructor(props) {\n    super(props);\n\n    this.onResize = event => {\n      // console.log(\"canvas, onResize\");\n      this._cvs.width = window.innerWidth || document.body.clientWidth;\n      this._cvs.height = window.innerHeight || document.body.clientHeight;\n      if (this.props.onResize) this.props.onResize(this._cvs.width, this._cvs.height);\n    };\n\n    this.onMouseDown = e => {\n      this.mouseObj.clicked = true;\n      this.mouseObj.clickedFrame = this._frameCnt;\n      if (this.props.onMouseDown) this.props.onMouseDown(e);\n    };\n\n    this.onMouseUp = e => {\n      if (this.props.onMouseUp) this.props.onMouseUp(e);\n    };\n\n    this.onMouseMove = e => {\n      this.setMouseLocal(e);\n      this.mouseObj.isMouseMoving = true;\n      if (this.props.onMouseMove) this.props.onMouseMove(e);\n    };\n\n    this.onTouchStart = e => {\n      if (this.props.onTouchStart) this.props.onTouchStart(e);\n    };\n\n    this.onTouchEnd = e => {\n      if (this.props.onTouchEnd) this.props.onTouchEnd(e);\n    };\n\n    this.onTouchMove = e => {\n      if (this.props.onTouchMove) this.props.onTouchMove(e);\n    };\n\n    this.onWheel = e => {\n      if (this.props.onWheel) this.props.onWheel(e);\n    };\n\n    this.resetMouseObj = () => {\n      this.mouseObj.isMouseMoving = false;\n      this.mouseObj.clicked = false;\n      this.mouseObj.clickedFrame = undefined;\n    };\n\n    this.setMouseLocal = event => {\n      // https://stackoverflow.com/questions/17130395/real-mouse-position-in-canvas\n      let rect = this._cvs.getBoundingClientRect();\n\n      let borderWidth = 0; // temp\n\n      let scaleX = this._cvs.width / (rect.width - borderWidth * 2);\n      let scaleY = this._cvs.height / (rect.height - borderWidth * 2);\n      let mouseX = (event.clientX - (rect.left + borderWidth)) * scaleX;\n      let mouseY = (event.clientY - (rect.top + borderWidth)) * scaleY;\n      let padding = 10;\n      let isMouseOverCanvas = mouseX >= padding && mouseX <= this._cvs.width - padding && mouseY >= padding && mouseY <= this._cvs.height - padding;\n      this.mouseObj.mouseX = mouseX;\n      this.mouseObj.mouseY = mouseY;\n      this.mouseObj.isMouseOverCanvas = isMouseOverCanvas;\n      this.mouseObj.deltaXfromCenter = mouseX - this._cvs.width / 2;\n      this.mouseObj.deltaYfromCenter = mouseY - this._cvs.height / 2;\n      return {\n        mouseX,\n        mouseY,\n        isMouseOverCanvas\n      };\n    };\n\n    this.loop = () => {\n      this._frameCnt += 1;\n      let {\n        draw,\n        isLooped = true\n      } = this.props;\n      draw(this._ctx, this._frameCnt, this.mouseObj);\n      this.resetMouseObj();\n\n      if (isLooped) {\n        this._frameId = window.requestAnimationFrame(this.loop);\n      }\n    };\n\n    this.canvasRef = /*#__PURE__*/React.createRef();\n    this.mouseObj = {\n      mouseX: undefined,\n      mouseY: undefined,\n      isMouseOverCanvas: false,\n      isMouseMoving: false,\n      clicked: false,\n      clickedFrame: undefined\n    };\n  }\n\n  componentDidMount() {\n    if (!this._frameId) {\n      // initiate properties\n      this._cvs = this.canvasRef.current;\n      this._ctx = this._cvs.getContext(\"2d\");\n      this._frameCnt = 0; // to pan and zoom map\n      // https://codepen.io/chengarda/pen/wRxoyB?editors=0110\n\n      this._cvs.addEventListener(\"mousedown\", this.onMouseDown);\n\n      window.addEventListener(\"mousemove\", this.onMouseMove);\n      window.addEventListener(\"mouseup\", this.onMouseUp);\n\n      this._cvs.addEventListener(\"touchstart\", this.onTouchStart);\n\n      window.addEventListener(\"touchmove\", this.onTouchMove);\n      window.addEventListener(\"touchend\", this.onTouchEnd);\n\n      this._cvs.addEventListener(\"wheel\", this.onWheel); // start loop\n      // console.log(\"start loop\");\n\n\n      this.loop();\n    }\n\n    window.addEventListener(\"resize\", this.onResize);\n    this.onResize();\n  }\n\n  componentWillUnmount() {\n    // console.log(\"cancel loop\");\n    window.cancelAnimationFrame(this._frameId);\n    window.removeEventListener(\"resize\", this.onResize);\n\n    if (this._cvs) {\n      this._cvs.removeEventListener(\"mousedown\", this.onMouseDown);\n\n      window.removeEventListener(\"mousemove\", this.onMouseMove);\n      window.removeEventListener(\"mouseup\", this.onMouseUp);\n\n      this._cvs.removeEventListener(\"touchstart\", this.onTouchStart);\n\n      window.removeEventListener(\"touchmove\", this.onTouchMove);\n      window.removeEventListener(\"touchend\", this.onTouchEnd);\n\n      this._cvs.removeEventListener(\"wheel\", this.onWheel);\n    }\n  }\n\n  render() {\n    let {\n      width = 300,\n      height = 300\n    } = this.props;\n    return /*#__PURE__*/_jsxDEV(\"canvas\", {\n      ref: this.canvasRef,\n      width: width,\n      height: height,\n      style: {\n        display: \"block\" // border: \"1px solid black\"\n\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 150,\n      columnNumber: 7\n    }, this);\n  }\n\n}","map":{"version":3,"sources":["/Users/shinhojung/git/raising-alien-creatures/client/src/components/Canvas/index.js"],"names":["React","Component","Canvas","constructor","props","onResize","event","_cvs","width","window","innerWidth","document","body","clientWidth","height","innerHeight","clientHeight","onMouseDown","e","mouseObj","clicked","clickedFrame","_frameCnt","onMouseUp","onMouseMove","setMouseLocal","isMouseMoving","onTouchStart","onTouchEnd","onTouchMove","onWheel","resetMouseObj","undefined","rect","getBoundingClientRect","borderWidth","scaleX","scaleY","mouseX","clientX","left","mouseY","clientY","top","padding","isMouseOverCanvas","deltaXfromCenter","deltaYfromCenter","loop","draw","isLooped","_ctx","_frameId","requestAnimationFrame","canvasRef","createRef","componentDidMount","current","getContext","addEventListener","componentWillUnmount","cancelAnimationFrame","removeEventListener","render","display"],"mappings":"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","sourcesContent":["import React, { Component } from \"react\";\n\nexport default class Canvas extends Component {\n  constructor(props) {\n    super(props);\n    this.canvasRef = React.createRef();\n    this.mouseObj = {\n      mouseX: undefined,\n      mouseY: undefined,\n      isMouseOverCanvas: false,\n      isMouseMoving: false,\n      clicked: false,\n      clickedFrame: undefined,\n    };\n  }\n\n  componentDidMount() {\n    if (!this._frameId) {\n      // initiate properties\n      this._cvs = this.canvasRef.current;\n      this._ctx = this._cvs.getContext(\"2d\");\n      this._frameCnt = 0;\n      // to pan and zoom map\n      // https://codepen.io/chengarda/pen/wRxoyB?editors=0110\n      this._cvs.addEventListener(\"mousedown\", this.onMouseDown);\n      window.addEventListener(\"mousemove\", this.onMouseMove);\n      window.addEventListener(\"mouseup\", this.onMouseUp);\n\n      this._cvs.addEventListener(\"touchstart\", this.onTouchStart);\n      window.addEventListener(\"touchmove\", this.onTouchMove);\n      window.addEventListener(\"touchend\", this.onTouchEnd);\n      this._cvs.addEventListener(\"wheel\", this.onWheel);\n\n      // start loop\n      // console.log(\"start loop\");\n      this.loop();\n    }\n    window.addEventListener(\"resize\", this.onResize);\n    this.onResize();\n  }\n\n  componentWillUnmount() {\n    // console.log(\"cancel loop\");\n    window.cancelAnimationFrame(this._frameId);\n    window.removeEventListener(\"resize\", this.onResize);\n    if (this._cvs) {\n      this._cvs.removeEventListener(\"mousedown\", this.onMouseDown);\n      window.removeEventListener(\"mousemove\", this.onMouseMove);\n      window.removeEventListener(\"mouseup\", this.onMouseUp);\n\n      this._cvs.removeEventListener(\"touchstart\", this.onTouchStart);\n      window.removeEventListener(\"touchmove\", this.onTouchMove);\n      window.removeEventListener(\"touchend\", this.onTouchEnd);\n\n      this._cvs.removeEventListener(\"wheel\", this.onWheel);\n    }\n  }\n\n  onResize = (event) => {\n    // console.log(\"canvas, onResize\");\n    this._cvs.width = window.innerWidth || document.body.clientWidth;\n    this._cvs.height = window.innerHeight || document.body.clientHeight;\n    if (this.props.onResize)\n      this.props.onResize(this._cvs.width, this._cvs.height);\n  };\n\n  onMouseDown = (e) => {\n    this.mouseObj.clicked = true;\n    this.mouseObj.clickedFrame = this._frameCnt;\n    if (this.props.onMouseDown) this.props.onMouseDown(e);\n  };\n\n  onMouseUp = (e) => {\n    if (this.props.onMouseUp) this.props.onMouseUp(e);\n  };\n\n  onMouseMove = (e) => {\n    this.setMouseLocal(e);\n    this.mouseObj.isMouseMoving = true;\n    if (this.props.onMouseMove) this.props.onMouseMove(e);\n  };\n\n  onTouchStart = (e) => {\n    if (this.props.onTouchStart) this.props.onTouchStart(e);\n  };\n\n  onTouchEnd = (e) => {\n    if (this.props.onTouchEnd) this.props.onTouchEnd(e);\n  };\n\n  onTouchMove = (e) => {\n    if (this.props.onTouchMove) this.props.onTouchMove(e);\n  };\n\n  onWheel = (e) => {\n    if (this.props.onWheel) this.props.onWheel(e);\n  };\n\n  resetMouseObj = () => {\n    this.mouseObj.isMouseMoving = false;\n    this.mouseObj.clicked = false;\n    this.mouseObj.clickedFrame = undefined;\n  };\n\n  setMouseLocal = (event) => {\n    // https://stackoverflow.com/questions/17130395/real-mouse-position-in-canvas\n    let rect = this._cvs.getBoundingClientRect();\n    let borderWidth = 0; // temp\n\n    let scaleX = this._cvs.width / (rect.width - borderWidth * 2);\n    let scaleY = this._cvs.height / (rect.height - borderWidth * 2);\n\n    let mouseX = (event.clientX - (rect.left + borderWidth)) * scaleX;\n    let mouseY = (event.clientY - (rect.top + borderWidth)) * scaleY;\n\n    let padding = 10;\n    let isMouseOverCanvas =\n      mouseX >= padding &&\n      mouseX <= this._cvs.width - padding &&\n      mouseY >= padding &&\n      mouseY <= this._cvs.height - padding;\n\n    this.mouseObj.mouseX = mouseX;\n    this.mouseObj.mouseY = mouseY;\n    this.mouseObj.isMouseOverCanvas = isMouseOverCanvas;\n\n    this.mouseObj.deltaXfromCenter = mouseX - this._cvs.width / 2;\n    this.mouseObj.deltaYfromCenter = mouseY - this._cvs.height / 2;\n\n    return {\n      mouseX,\n      mouseY,\n      isMouseOverCanvas,\n    };\n  };\n\n  loop = () => {\n    this._frameCnt += 1;\n    let { draw, isLooped = true } = this.props;\n    draw(this._ctx, this._frameCnt, this.mouseObj);\n    this.resetMouseObj();\n    if (isLooped) {\n      this._frameId = window.requestAnimationFrame(this.loop);\n    }\n  };\n\n  render() {\n    let { width = 300, height = 300 } = this.props;\n    return (\n      <canvas\n        ref={this.canvasRef}\n        width={width}\n        height={height}\n        style={{\n          display: \"block\",\n          // border: \"1px solid black\"\n        }}\n      />\n    );\n  }\n}\n"]},"metadata":{},"sourceType":"module"}